<!DOCTYPE html>
<html>
<head>
  <title>Rank dos Indicadores por Microrregião e Ano</title>
  <link rel="stylesheet" type="text/css" href="https://akkajah.github.io/visualizador-de-tabelas/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://akkajah.github.io/visualizador-de-tabelas/css/bootstrap.min.css">
  <style>
    .data-table {
      width: 100%;
      height: 500px; /* Ajuste a altura conforme necessário */
      overflow: auto;
    }
    table.dataTable {
      width: 100% !important;
    }
  </style>
</head>
<body>
  <h1>Rank dos Indicadores por Microrregião e Ano</h1>
  <label for="year_filter">Selecione o Ano:</label>
  <select id="year_filter">
    <option value="">Selecionar</option>
    <!-- Opções de anos serão adicionadas dinamicamente -->
  </select>
  <label for="indicator_filter">Selecione o Indicador:</label>
  <select id="indicator_filter">
    <option value="">Selecionar</option>
    <!-- Opções de indicadores serão adicionadas dinamicamente -->
  </select>
  <button id="search_button">Buscar</button>
  <div id="tables_container"></div>
  <script src="https://akkajah.github.io/visualizador-de-tabelas/js/jquery-3.5.1.min.js"></script>
  <script src="https://akkajah.github.io/visualizador-de-tabelas/js/jquery.dataTables.min.js"></script>
  <script>
    var df_filtered = <!-- Dados JSON embutidos aqui -->;

    $(document).ready(function() {
      console.log('Document ready');
      function updateTable() {
        var year = $('#year_filter').val();
        var indicator = $('#indicator_filter').val();
        if (year && indicator) {
          console.log('Updating table:', 'Year: ' + year + ', Indicator: ' + indicator);
          $('.data-table').remove();
          var filteredData = df_filtered.filter(function(row) {
            return row.Ano == year && row.Indicador == indicator;
          });

          var tableHtml = '<div class="data-table"><table id="table_' + year + '_' + indicator + '" class="display" style="width:100%"><thead><tr><th>Nome da Microrregião</th><th>Rank</th></tr></thead><tbody>';
          filteredData.forEach(function(row) {
            tableHtml += '<tr><td>' + row.nome_microrregiao + '</td><td>' + row.Rank + '</td></tr>';
          });
          tableHtml += '</tbody></table></div>';

          $('#tables_container').html(tableHtml);

          // Initialize DataTable
          $('#table_' + year + '_' + indicator).DataTable({
            searching: false, // Disable search input
            dom: 'rtip', // Remove the search input
            autoWidth: false, // Disable auto width to use the fixed width
            order: [[1, 'asc']] // Ordenar pela coluna Rank (segunda coluna)
          });

          // Adjust body height to force re-rendering
          $('body').css('height', '110%');
          setTimeout(function() {
            $('body').css('height', '100%');
          }, 1000); // Return to 100% after 1 second
        } else {
          alert('Por favor, selecione um ano e um indicador.');
        }
      }
      $('#search_button').click(updateTable);

      // Inicializar todas as tabelas DataTable no início
      $('.data-table table').each(function() {
        $(this).DataTable({
          searching: false, // Disable search input
          dom: 'rtip', // Remove the search input
          autoWidth: false, // Disable auto width to use the fixed width
          order: [[1, 'asc']] // Ordenar pela coluna Rank (segunda coluna)
        });
      });
    });
  </script>
</body>
</html>
